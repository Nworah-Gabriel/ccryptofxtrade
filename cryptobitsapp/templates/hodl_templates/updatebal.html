
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
  {% load static %}
  <link rel="icon" type="image/png" href="{% static 'hodl_static/images/logoicon.png' %}">
  <title>Hodlvault</title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="{% static 'hodl_static/assets/css/nucleo-icons.css' %}" rel="stylesheet" />
  <link href="{% static 'hodl_static/assets/css/nucleo-svg.css' %}" rel="stylesheet" />
 
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
   <link href="{% static 'hodl_static/assets/css/nucleo-svg.css' %}" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="{% static 'hodl_static/assets/css/soft-ui-dashboard.css?v=1.0.3' %}" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'hodl_static/fontawesome/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'hodl_static/dashboard.css' %}">
  <script src="{% static 'hodl_static/js/jquery.min.js' %}"></script>
    
<style>/* The alert message box */
  .alert_message {
      margin-top: 30px;
    padding: 20px;
    background-color: #173e43;
    color: white;
    display:none;
  }
  
  .closebtn_message {
    margin-left: 15px;
    color: white;
    font-weight: bold;
    float: right;
    font-size: 22px;
    line-height: 20px;
    cursor: pointer;
    transition: 0.3s;
  }
  
  .closebtn_message:hover {
    color: black;
  }</style>
</head>

<body class="g-sidenav-show  bg-gray-100">
  <main class="main-content position-relative max-height-vh-100 h-100 mt-1 border-radius-lg ">
    <div class="container-fluid py-4">
        <h3 class="mb-0 mt-3 userlisthead">Hodlvault User List</h3>
        <div class="alert_message" id="alertUpdate" style="background-color:{{color}};">
          <span class="closebtn_message" onclick="this.parentElement.style.display='none';">&times;</span>
          <p id="alertUpdateMessage"></p></div>

        <div class="usermodal-bg">
            <div class="usermodals">
                    <div class="usercard">
                  <div class="card p-5">
                    <i class="fa fa-window-close close" style="color: red" aria-hidden="true"></i>
                   <h3 style="color: #b312c2" class="text-center">Kendal James</h3>
                 
                   <p class="balance text-center">Balance: <b>$3000</b></p>

                   <form action="">
                       <div class="form-group bal">
                        <a type="button" class="btn btn-primary">-</a>
                         <input type="text" class="form-control" name="" id="" aria-describedby="helpId" placeholder="">
                         <a type="button" class="btn btn-primary">+</a>
                         
                        </div>
                  
                       


                         <!-- <p class="balance text-center">Bonus:<b>$300</b></p> -->

                
                       <!-- <div class="form-group bal">
                        <a type="button" class="btn btn-primary">-</a>
                         <input type="text" class="form-control" name="" id="" aria-describedby="helpId" placeholder="">

                         <a type="button" class="btn btn-primary">+</a>
                        </div> -->
                   
                        <div class="alignfix">
                         <button type="button" class="btn btn-primary priceupdate">Upadate</button>
                        </div>
                    </form>

                  </div>
                </div>
               
                
             
              
            </div>
          </div>

          <div class="searchbar">
            <form action="">
              <div class="form-group">       
                <div class="input-group">
                  <input class="form-control" type="text" name="" placeholder="Find User" aria-label="Recipient's " aria-describedby="my-addon">
                  <div class="input-group-append">
                    <button class="input-group-text btn-primary" id="my-addon"><i class="fa fa-search"></i></button>
                  </div>
                </div>
              </div>
            </form>
          </div>
<div class="row">
        <div class="col-md-12 mt-0">
            <div class="userlist">
          <div class="card">
            <!-- <div class="card-header pb-0 px-3">
            </div> -->

            <div class="card-body pt-4 p-3">
              <div class="table-responsive p-0">
                <table class="table align-items-center justify-content-center mb-0">
                  <thead>
                    <tr>
                      <th class="text-uppercase text-secondary text-sm text-dark font-weight-bolder">Name</th>
                      <th class="text-uppercase text-secondary text-sm text-dark font-weight-bolder ps-2">Balance</th>
                      <!-- <th class="text-uppercase text-secondary text-sm text-dark font-weight-bolder ps-2">Bonus</th> -->
                      <th class="text-uppercase text-secondary text-sm text-dark font-weight-bolder ps-2">Edit</th>
                    </tr>
                  </thead>
                  <tbody>
                    {%for person in all_users %}
                    <tr>
                      <td>
                        {{person.user.username}}
                      </td>
                      <td>
                        <p class="text-sm font-weight-bold mb-0">${{person.balance}}</p>
                      </td>
                      <!-- <td>
                        <p class="text-sm font-weight-bold mb-0">${{person.bonus}}</p>
                      </td> -->
                      <td>
                        <form method="POST" class = "UpdateFormClass" id="formUpdate-{{person.user.username}}" >
        
                          {%csrf_token%}
                          <!-- IMPORTANT: THE ARRANGEMENT OF THIS FIELD WOULD AFFECT THE SUCCESS FUNCTION OF THIS FIELD, WHEN IT NEEDS TO GET THE USERNAME  -->
                         <div id = "editedbal_{{person.user.username}}">
                          <input id= "editedBal-{{person.user.username}}" name="{{updatebalanceform.newbalance.name}}"  value="0" type="integer"></input></br>
                         </div>
                          <input type="button" color="red" value="+" onclick="subBalance('add','{{person.user.username}}')"></input>
                          <input id="username-{{person.user.username}}" name="username" value="{{person.user.username}}"type="hidden"></input>
                          <input id="amount-{{person.user.username}}" name="" value="0.00" type="integer"></input>

                          <input type="button"  color="red" value="-" onclick="subBalance('sub', '{{person.user.username}}')"></input>
                          <div class="form-group">
                            <label for="">Select Coin:</label>
                            <select class="form-control" name="select_coin-{{person.user.username}}" id="coin_type-{{person.user.username}}" onchange="if (this.selectedIndex) console.log('ok'); converter(this.value, this );">
                              {% for coin in coins%}
                              <option>{{coin.name}}</option>
                              {%endfor%}
                              
                            </select>
                          </div>
                          <input type="checkbox" id="send_email-{{person.user.username}}"  name="{{updatebalanceform.send_email.name}}"   >send email</input> 
                          <button type="submit" id="submit" class="btn btn-primary submit"  onclick="$('#formUpdate-{{person.user.username}}').on('submit',function(e){
                            e.preventDefault();
                            
                            {{person.user.username}}function();
                            submitform();
                        });">Submit</button>
                       
                        </form>
                        <script>
        
                          function subBalance(sign, username){
                          let edited_balance_id = "editedBal-" + username
                          edited_balance=document.getElementById(edited_balance_id); 
                          let edited_balance_value = parseFloat(edited_balance.value);
                          let change_id = "amount-" + username
                          console.log(change_id)
                          change = document.getElementById(change_id);
                          let change_value = parseFloat(change.value);
                            if (sign === 'add'){
                  
                              let edited = edited_balance_value + change_value ;
                              document.getElementById( edited_balance_id).value = edited;
                              
                  
                  
                            }
                            
                            else if (sign === 'sub'){
                              let edited = edited_balance_value - change_value ;
                              document.getElementById(edited_balance_id).value = edited;
                              
                  
                  
                            }
                           
                  
                          }
                        
                        </script>
                      </td>
                    </tr>
                    {%endfor%}

                   
                 
                  </tbody>
                </table>
                <form action="#" class="ml-2" id="formUpdate" style="display:none;">
                  {%csrf_token%}
                  
              
                <input type="text" name="{{updatebalanceform.amount.name}}" id= "id_{{updatebalanceform.amount.name}}"  value="">
                <input type="text" name="{{updatebalanceform.username.name}}" id="id_{{updatebalanceform.username.name}}" value="">
                <input type="text" name="{{updatebalanceform.newbalance.name}}" id="id_{{updatebalanceform.newbalance.name}}" value="">
                <input type="text" name="{{updatebalanceform.coin_type.name}}" id="id_{{updatebalanceform.coin_type.name}}" value="">
                
                <input type="checkbox" name="{{updatebalanceform.send_email.name}}" id="id_{{updatebalanceform.send_email.name}}"  color="red" value="">send email</input>
              
              
              </form>
              </div>
            </div>
      
          </div>
        </div>
        </div>
      </div>

    </div>
  </main>

  <!-- scripts -->
  <script>

    amount = document.getElementById("id_{{updatebalanceform.amount.name}}");
    username = document.getElementById("id_{{updatebalanceform.username.name}}");
    coin_type = document.getElementById("id_{{updatebalanceform.coin_type.name}}");
    send_email = document.getElementById("id_{{updatebalanceform.send_email.name}}");
    newbalance = document.getElementById("id_{{updatebalanceform.newbalance.name}}");
  
   {% for person in all_users %}
     function {{person.user.username}}function() {
       const formupdate{{person.user.username}} = document.getElementById("formUpdate-{{person.user.username}}");
       console.log(formupdate{{person.user.username}});
       amount.value = formupdate{{person.user.username}}.elements['amount-{{person.user.username}}'].value;
       username.value = formupdate{{person.user.username}}.elements['username-{{person.user.username}}'].value;
       coin_type.value = formupdate{{person.user.username}}.elements['coin_type-{{person.user.username}}'].value;
       newbalance.value = formupdate{{person.user.username}}.elements['editedBal-{{person.user.username}}'].value;
       if (formupdate{{person.user.username}}.elements['send_email-{{person.user.username}}'].checked == true){
        send_email.value = "1";
       }
       else {
        send_email.value = "0";
       }
       send_email.checked = formupdate{{person.user.username}}.elements['send_email-{{person.user.username}}'].checked;
       
       var send_email_old= formupdate{{person.user.username}}.elements['send_email-{{person.user.username}}'].checked;


       
  
       
     }
     
     {% endfor %}
  
    
     
  
       
   </script>
 
  <script src="{% static 'hodl_static/js/jquery.js' %}"></script>
  <script>
    
    function submitform(){
    
    $.ajax({
          type:"POST",
          url :"{% url 'update_balance' %}",
          data : $("#formUpdate").serialize(),
          async: false,
          dataType:'json',
          success:function(data){
              if (data.msg === "Success"){
                  const alert = document.getElementById("alertUpdate");
                  alert.style.display = 'block';
                  alert.style.background = "green";
                  $("#alertUpdateMessage").text(data.response);
                  const allForms = document.getElementsByClassName("UpdateFormClass");
                  
                  for (let i = 0; i < Object.keys(allForms).length; i++) {
                    var newForm_id = allForms[i].id;
                    const newform = document.getElementById(newForm_id);
                    // var username = newform[3].value;
                    var username = newform.elements["username"].value;
                    var editedform_id = 'formUpdate-' + data.username;
                    
                    
                    newform.reset();
                    updateDiv(username);
                    function updateDiv(username)
                      { 
                        var editedbal_div = "#editedbal_" + username;
                        var currentbal_div = "#currentbal_" + username;
                  
                        $( editedbal_div ).load(window.location.href + " " + editedbal_div );
                        $( currentbal_div ).load(window.location.href + " " + currentbal_div );
                        
                      }
                     
                    }
                    }

              else if (data.msg === "Invalid"){
                  const alert = document.getElementById("alertUpdate");
                  alert.style.display = 'block';
                  alert.style.background = "red";
                  $("#alertUpdateMessage").text(data.response)
                  }
              else if (data.msg === "Fail"){
                  const alert = document.getElementById("alertUpdate");
                  alert.style.display = 'block';
                  alert.style.background = "red";
                  $("#alertUpdateMessage").text(data.response)
              }
              else{
                  const alert = document.getElementById("alertUpdate");
                  alert.style.display = 'block';
                  alert.style.background = "red";
                  $("#alertUpdateMessage").text("An Unexpected Error Occured")

                }
          }
      })

  }



 </script>



  <!--   Core JS Files   -->
  <script src="{% static 'hodl_static/assets/js/core/popper.min.js' %}"></script>
  <script src="{% static 'hodl_static/assets/js/core/bootstrap.min.js' %}"></script>
  <script src="{% static 'hodl_static/assets/js/plugins/perfect-scrollbar.min.js' %}"></script>
  <script src="{% static 'hodl_static/assets/js/plugins/smooth-scrollbar.min.js' %}"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="{% static 'hodl_static/assets/js/soft-ui-dashboard.min.js?v=1.0.3' %}"></script>
  <!-- <script src="{% static 'hodl_static/js/package.js' %}"></script> -->
</body>

</html>